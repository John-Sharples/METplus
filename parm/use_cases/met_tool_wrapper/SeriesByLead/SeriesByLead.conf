#
# This conf files is an example of running the SeriesByLead METplus wrapper process 
# by itself, stand alone.
#
# This conf files was based off the original feature_relative.conf and the
# series_by_lead_all_fhrs.conf files.,
#

#
#  CONFIGURATION
#
[config]

# Looping by processes: run each 'task' in the PROCESS_LIST for all
# defined times then steps to the next 'task'.
LOOP_ORDER = processes

# Configuration files
TC_STAT_CONFIG_FILE = {CONFIG_DIR}/TCStatConfig_wrapped
SERIES_ANALYSIS_CONFIG_FILE = {CONFIG_DIR}/SeriesAnalysisConfig_wrapped

#PROCESS_LIST = TcPairs, ExtractTiles, SeriesByLead
PROCESS_LIST = SeriesByLead

SERIES_ANALYSIS_REGRID_TO_GRID = latlon 60 60 23 -115 0.5 0.5

## NOTE: "TOTAL" is a REQUIRED cnt statistic used by the series analysis scripts
#STAT_LIST = TOTAL, FBAR, OBAR, ME, MAE, RMSE, BCMSE, E50, EIQR, MAD
SERIES_ANALYSIS_STAT_LIST = TOTAL, FBAR, OBAR, ME

# The init time begin and end times, increment
LOOP_BY = INIT
INIT_TIME_FMT = %Y%m%d
INIT_BEG = 20141214
INIT_END = 20141214

# This is the step-size. Increment in seconds from the begin time to the end
# time
INIT_INCREMENT = 21600 ;; set to every 6 hours=21600 seconds

# A list of times to include, in format YYYYMMDD_hh
INIT_INCLUDE =

# A list of times to exclude, in format YYYYMMDD_hh
INIT_EXCLUDE =

# if true, run series_by_lead for groups of forecasts
#  must set LEAD_SEQ_[N] and LEAD_SEQ_[N]_LABELS for N > 0 groups
# if false, run series_by_lead for all forecast hours
#  must set LEAD_SEQ
SERIES_ANALYSIS_GROUP_FCSTS = False

# Used for performing series analysis based on lead time
LEAD_SEQ = begin_end_incr(0,96,6)

# Constants used in creating the tile grid, used by extract tiles
EXTRACT_TILES_NLAT = 60
EXTRACT_TILES_NLON = 60

# Resolution of data in degrees, used by extract tiles
EXTRACT_TILES_DLAT = 0.5
EXTRACT_TILES_DLON = 0.5

# Degrees to subtract from the center lat and lon to
# calculate the lower left lat (lat_ll) and lower
# left lon (lon_ll) for a grid that is 2n X 2m,
# where n = EXTRACT_TILES_LAT_ADJ degrees and m = EXTRACT_TILES_LON_ADJ degrees.
# For this case, where n=15 and m=15, this results
# in a 30 deg X 30 deg grid.  Used by extract tiles
EXTRACT_TILES_LON_ADJ = 15
EXTRACT_TILES_LAT_ADJ = 15

##
#
# TC-STAT filtering options, used for extract tiles and series analysis
#
##
#EXTRACT_TILES_FILTER_OPTS =
EXTRACT_TILES_FILTER_OPTS = -basin ML
SERIES_ANALYSIS_FILTER_OPTS = -init_beg {INIT_BEG} -init_end {INIT_END}

# Run tc_stat using a config file or as command line
# if running via MET tc_stat config file, set to CONFIG.  Leave blank or
# anything other than CONFIG if running via command line.  In this case,
# tc_stat is called by one of the METplus wrappers, so don't assign anything to
# this keyword.
TC_STAT_RUN_VIA =

# For arithmetic expressions such as:
# -column 'ABS(AMSLP-BMSLP)', enclose the expression in ''.
# Notice that there are no
# whitespaces within the arithmetic expression.  White spaces are to be used to
# separate options from values
# (e.g. -job summary -by AMODEL,LEAD,AMSLP -init_hour 00 -column 'AMSLP-BMSLP').
# eg. -lookin {OUTPUT_BASE}/tc_pairs -job filter -dump_row
#             {OUTPUT_BASE}/tc_stat_filter.out -basin ML -init_hr 00
# or -lookin {OUTPUT_BASE}/tc_pairs -job summary -by AMODEL,LEAD -column AMSLP
#    -column AMAX_WIND -column 'ABS(AMAX_WIND-BMAX_WIND)'
#    -out {OUTPUT_BASE}/tc_stat/tc_stat_summary.tcst

# NOTE: Since we aren't explicitly indicating TC_STAT in our process list
# (i.e. tc_stat is being called within another wrapper), leave this
# blank/undefined.
TC_STAT_CMD_LINE_JOB =

# Specify whether only those track points common to both the ADECK and BDECK
# tracks should be written out.  This is only used when explicitly calling
# TC_STAT in the PROCESS_LIST.  This is not used in this use case, so setting
# it to either false or true has no impact.
TC_STAT_MATCH_POINTS = false

##
# !!!DO NOT MODIFY THESE!!!, they are required for all config files with
# processes that call tc_stat, but only need valid values when tc_stat
# is explicitly listed in the PROCESS_LIST.  This use case does not
# require tc_stat to be explicitly listed in the PROCESS_LIST, tc_stat
# is invoked from within one or more of the other items in the PROCESS_LIST
# (i.e. when filtering within extract tiles or within series analysis).
#
#  FILL in the following values if running multiple jobs which
#  requires a MET tc_stat config file.
#
##

# These all map to the options in the default TC-Stat config file, except these
# are pre-pended with TC_STAT to avoid clashing with any other similarly
# named options from other MET tools (eg TC_STAT_AMODEL corresponds to the
# amodel option in the default MET tc-stat config file, whereas AMODEL
# corresponds to the amodel option in the MET tc-pairs config file).

# Stratify by these columns:
TC_STAT_AMODEL =
TC_STAT_BMODEL =
TC_STAT_DESC =
TC_STAT_STORM_ID =
TC_STAT_BASIN =
TC_STAT_CYCLONE =
TC_STAT_STORM_NAME =

# Stratify by init times via a comma-separate list of init times to
# include or exclude.  Time format defined as YYYYMMDD_HH or YYYYMMDD_HHmmss
TC_STAT_INIT_BEG = 20141213
TC_STAT_INIT_END = 20141220
TC_STAT_INIT_INCLUDE =
TC_STAT_INIT_EXCLUDE =
TC_STAT_INIT_HOUR = 00
# Stratify by valid times via a comma-separate list of valid times to
# include or exclude.  Time format defined as YYYYMMDD_HH or YYYYMMDD_HHmmss
TC_STAT_VALID_BEG =
TC_STAT_VALID_END =
TC_STAT_VALID_INCLUDE =
TC_STAT_VALID_EXCLUDE =
TC_STAT_VALID_HOUR =
TC_STAT_LEAD_REQ =
TC_STAT_INIT_MASK =
TC_STAT_VALID_MASK =
# Stratify by the valid time and lead time via comma-separated list of
# times in format HH[MMSS]
TC_STAT_VALID_HOUR =
TC_STAT_LEAD =

# Stratify over the watch_warn column in the tcst file.  Setting this to
# 'ALL' will match HUWARN, HUWATCH, TSWARN, TSWATCH
TC_STAT_TRACK_WATCH_WARN =

# Stratify by applying thresholds to numeric data columns.  Specify with
# comma-separated list of column names and thresholds to be applied.
# The length of TC_STAT_COLUMN_THRESH_NAME should be the same as
# TC_STAT_COLUMN_THRESH_VAL.
TC_STAT_COLUMN_THRESH_NAME =
TC_STAT_COLUMN_THRESH_VAL =

# Stratify by a list of comma-separated columns names and values corresponding
# to non-numeric data columns of the values of interest.
TC_STAT_COLUMN_STR_NAME =
TC_STAT_COLUMN_STR_VAL =

# Stratify by applying thresholds to numeric data columns only when lead=0.
# If lead=0 and the value does not meet the threshold, discard the entire
# track.  The length of TC_STAT_INIT_THRESH_NAME must equal the length of
# TC_STAT_INIT_THRESH_VAL.
TC_STAT_INIT_THRESH_NAME =
TC_STAT_INIT_THRESH_VAL =

# Stratify by applying thresholds to numeric data columns only when lead = 0.
# If lead = 0 but the value doesn't meet the threshold, discard the entire
# track.
TC_STAT_INIT_STR_NAME =
TC_STAT_INIT_STR_VAL =

# Excludes any points where distance to land is <=0. When set to TRUE, once land
# is encountered, the remainder of the forecast track is NOT used for the
# verification, even if the track moves back over water.
TC_STAT_WATER_ONLY =

# TRUE or FALSE.  To specify whether only those track points occurring near
# landfall should be retained. Landfall is the last bmodel track point before
# the distance to land switches from water to land.
TC_STAT_LANDFALL =

# Define the landfall retention window, which is defined as the hours offset
# from the time of landfall. Format is in HH[MMSS]. Default TC_STAT_LANDFALL_BEG
# is set to -24, and TC_STAT_LANDFALL_END is set to 00
TC_STAT_LANDFALL_BEG = -24
TC_STAT_LANDFALL_END = 00

# Specify whether only those track points common to both the ADECK and BDECK
# tracks should be written out
TC_STAT_MATCH_POINTS = false

# IMPORTANT  Refer to the README_TC for details on setting up analysis
# jobs (located in {MET_INSTALL_DIR}/share/met/config

# Separate each option and value with whitespace, and each job with a whitespace.
# No whitespace within arithmetic expressions or lists of items
# (e.g. -by AMSLP,AMODEL,LEAD -column '(AMAX_WIND-BMAX_WIND)')
# Enclose your arithmetic expressions with '' and separate each job
# by whitespace:
#  -job filter -dump_row /path/to,  -job summary -line_type TCMPR  -column 'ABS(AMAX_WIND-BMAX_WIND)' -out {OUTPUT_BASE}/tc_stat/file.tcst

TC_STAT_JOBS_LIST = -job summary -line_type TCMPR -column 'ABS(AMAX_WIND-BMAX_WIND)' -dump_row {OUTPUT_BASE}/tc_stat/tc_stat_summary.tcst

#
# !!!END of DO NOT MODIFY!!!
#

# OVERWRITE OPTIONS
# Don't overwrite filter files if they already exist.
# Set to no if you do NOT want to override existing files
# Set to yes if you do want to override existing files
EXTRACT_TILES_OVERWRITE_TRACK = no

# PLOTTING Relevant to series analysis plots.
# By default, background map is turned off. Set
# to no to turn of plotting of background map.
SERIES_ANALYSIS_BACKGROUND_MAP = no

# Used by extract tiles and series analysis to define the records of
# interest from the grib2 file
# HGT/P500, PRMSL/Z0, TMP/Z2, PWAT/L0, HGT/P250, TMP/P850, TMP/P500, UGRD/P250, VGRD/P250

BOTH_VAR1_NAME = TMP
BOTH_VAR1_LEVELS = P850

BOTH_VAR2_NAME = HGT
BOTH_VAR2_LEVELS = P500


#
#  FILENAME TEMPLATES
#
[filename_templates]
# Define the format of the filenames
FCST_EXTRACT_TILES_INPUT_TEMPLATE = gfs_4_{init?fmt=%Y%m%d}_{init?fmt=%H}00_{lead?fmt=%HHH}.grb2
OBS_EXTRACT_TILES_INPUT_TEMPLATE = gfs_4_{valid?fmt=%Y%m%d}_{valid?fmt=%H}00_000.grb2


#
#  DIRECTORIES
#
[dir]
# MET config directory.
# CONFIG_DIR and the value it expands to is set as an environment variable
# and is used in the MET configuration file.
CONFIG_DIR={PARM_BASE}/met_config

# Location of your model data of interest
EXTRACT_TILES_GRID_INPUT_DIR = {INPUT_BASE}/met_test/new/reduced_model_data

# The TC_STAT_INPUT_DIR, TC_STAT_OUTPUT_DIR, and TC_STAT_CONFIG_FILE
# must be present but are not needed in this use case since tc_stat is
# being invoked from within another wrapper, rather than explicitly
# listed in the PROCESS_LIST to run on its own.
# TC-Stat input data (uses output from tc-pairs)
TC_STAT_INPUT_DIR = {OUTPUT_BASE}/tc_pairs

# TC-Stat output data (creates .tcst ASCII files which can be read or used as
# input to TCMPR_Plotter_wrapper (the Python wrapper to plot_tcmpr.R) to create plots.
TC_STAT_OUTPUT_DIR = {OUTPUT_BASE}/tc_stat

# Use this setting to separate the filtered track files from
# the series analysis directory.
# EXTRACT_TILES_OUTPUT_DIR = {OUTPUT_BASE}/extract_tiles
# Note: Typically SeriesByLead runs TcPairs, ExtractTiles, SeriesByLead
# and the ExtractTiles output is the input to SeriesByLead.
# SERIES_ANALYSIS_INPUT_DIR = {EXTRACT_TILES_OUTPUT_DIR}
SERIES_ANALYSIS_INPUT_DIR = {INPUT_BASE}/met_test/extract_tiles
SERIES_ANALYSIS_FILTERED_OUTPUT_DIR = {OUTPUT_BASE}/series_lead_filtered

# Define the output directories for Series analysis by lead and init
SERIES_ANALYSIS_OUTPUT_DIR = {OUTPUT_BASE}/series_analysis_lead

#
#  REGEX PATTERNS
#
[regex_pattern]
# Regular expressions that are used in series analysis
# Forecast and Analysis tile files, and ASCII files
# created by the series analysis by init and lead time

# Indicate the prefix to the output netCDF files generated by 
# MET series_analysis
# For example, MET will produce files with the following format:
#  <prefix>__F018_gfs_4_20141215_0000_018.nc
# and the <prefix> enables the user to distinguish the forecast
# files from the analysis files
FCST_EXTRACT_TILES_PREFIX = FCST_TILE_F
OBS_EXTRACT_TILES_PREFIX = ANLY_TILE_F

#
# Indicate the regular expression of the files that were created by the
# extract tiles wrapper.  This information is used to check that input tiles
# exist before proceeding with the series analysis process.
#
# These are the forecast and analysis input files that are expected if regridding
# is to be performed by MET regrid_data_plane
FCST_SERIES_ANALYSIS_TILE_REGEX = .*FCST_TILE_F.*.grb2
OBS_SERIES_ANALYSIS_TILE_REGEX = .*ANLY_TILE_F.*.grb2

# These are the forecast and analysis input files that are expected if regridding
# is to be done via the NOAA wgrib2 tool.
FCST_SERIES_ANALYSIS_NC_TILE_REGEX = .*FCST_TILE_F.*.nc
OBS_SERIES_ANALYSIS_NC_TILE_REGEX = .*ANLY_TILE_F.*.nc

# The regular expression describing the format of the forecast and analysis files 
# that contain a list of the gridded files included in the series analysis.  This
# information is used to clean up pre-existing forecast and analysis files.
FCST_SERIES_ANALYSIS_ASCII_REGEX_LEAD = FCST_FILE_F.*
OBS_SERIES_ANALYSIS_ASCII_REGEX_LEAD = ANLY_FILE_F.*

[exe]
